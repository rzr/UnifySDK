<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZigPC Developer Guide &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/applications/zigpc/readme_developer.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/js/charenc.js"></script>
        <script src="../../_static/js/crypt.js"></script>
        <script src="../../_static/js/sha1.js"></script>
        <script src="../../_static/js/html5-qrcode.min.js"></script>
        <script src="../../_static/js/qr_code_scanner.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ZigPC Coding Standard" href="coding_standard.zigpc.html" />
    <link rel="prev" title="ZigPC User’s Guide" href="readme_user.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../doc/introduction.html" class="icon icon-home"> Unify
            <img src="../../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../doc/introduction.html">Unify Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/getting_started_unify.html">Getting Started with Unify</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../doc/UnifySDK.html">Unify Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/unify_framework_services.html">Framework Services</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../doc/protocol_controllers.html">Protocol Controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../doc/protocol/zwave/zpc_introduction.html">Z-Wave (ZPC)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc/protocol/zigbee/zigpc_introduction.html">Zigbee (ZigPC)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="readme_user.html">ZigPC User’s Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ZigPC Developer Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-instructions">Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-underlying-slc-based-zigbee-host-library">Modifying Underlying SLC-based Zigbee Host Library</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-instructions">Install Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-console-logs">Reading Console Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-zigbee-network-analyzer-to-monitor-pan">Using Zigbee Network Analyzer to Monitor PAN</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="coding_standard.zigpc.html">ZigPC Coding Standard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/multiprotocol.html">Multiprotocol Host Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/protocol/matter/matter_mpc.html">Matter Protocol Controller (MPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/protocol/aox/aox_introduction.html">Bluetooth AoX (AoXPC)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/unify_iot_services.html">IoT Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../doc/getting_started_as_developer.html">Getting Started as a Developer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../doc/unify_specifications/index.html">Unify Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/standards/known-abbreviations.html">Known Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../doc/introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="zigpc-developer-guide">
<h1>ZigPC Developer Guide<a class="headerlink" href="#zigpc-developer-guide" title="Permalink to this heading"></a></h1>
<p>This readme is intended for Unify Framework developers, who are trying to cross compile,
install, and run ZigPC on a Raspberry Pi.</p>
<section id="build-instructions">
<h2>Build Instructions<a class="headerlink" href="#build-instructions" title="Permalink to this heading"></a></h2>
<p>This guide describes how to cross compile the Zigbee Protocol Controller / ZigPC
for Raspberry Pi using Docker on your work station. If you haven’t already built
the Unify docker image, follow the guide in the docker folder
<a class="reference internal" href="../../docker/readme_developer.html"><span class="doc std std-doc">readme.md</span></a> file.</p>
<section id="set-up-gecko-sdk">
<h3>Set up Gecko SDK<a class="headerlink" href="#set-up-gecko-sdk" title="Permalink to this heading"></a></h3>
<p>The Zigbee Protocol Controller uses certain functionality in the
<a class="reference external" href="https://docs.silabs.com/gecko-platform/latest/">GeckoSDK</a>. The Gecko SDK can be
downloaded through <a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity
Studio</a>. The ZigPC uses the
<a class="reference external" href="https://www.silabs.com/developers/zigbee-emberznet">EmberZNet library</a> provided
through the Gecko Platform. See the [AN0822: Simplicity Studio User’s Guide]
(<a class="reference external" href="https://www.silabs.com/documents/public/application-notes/AN0822-simplicity-studio-user-guide.pdf">https://www.silabs.com/documents/public/application-notes/AN0822-simplicity-studio-user-guide.pdf</a>)
for more information. In summary, select the EmberZNet library at installation
time or, when creating a new project, select “Manage SDKs” followed by
“Customize Installation”.</p>
<p>After EmberZNet/GeckoSDK is installed, locate its path (e.g.,
~/SimplicityStudio/SDKs/gecko_sdk/). Currently, v4.0 is supported. Set the
environment variable $GSDK_LOCATION to this path.</p>
</section>
</section>
<section id="modifying-underlying-slc-based-zigbee-host-library">
<h2>Modifying Underlying SLC-based Zigbee Host Library<a class="headerlink" href="#modifying-underlying-slc-based-zigbee-host-library" title="Permalink to this heading"></a></h2>
<p>The Zigbee Protocol Controller imports a Silicon Labs Configurator based UC
project as a static library. This project should be configured in combination
with any ZCL support changes performed.</p>
<p>See the <a class="reference internal" href="components/zigpc_gateway/libs/zigbee_host/readme.libzigbee_host.zigpc.html"><span class="doc std std-doc">Zigbee Host Library Readme</span></a>
for more details.</p>
<section id="cross-compiling-for-raspberry-pi-using-docker">
<h3>Cross Compiling for Raspberry Pi Using Docker<a class="headerlink" href="#cross-compiling-for-raspberry-pi-using-docker" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Cross compilation builds currently supports only the Raspberry Pi OS Bookworm.</p>
</div></blockquote>
<p>From the root of the Unify source directory, run the following:</p>
<ul class="simple">
<li><p>Build the Docker container image:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docker
./build_docker.sh<span class="w"> </span>arm64<span class="w"> </span>uic_arm64
<span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
<ul class="simple">
<li><p>Run the container with the GSDK locations mounted:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--env<span class="w"> </span>GSDK_LOCATION<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>:<span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-w<span class="w"> </span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span><span class="si">${</span><span class="nv">GSDK_LOCATION</span><span class="si">}</span>:<span class="si">${</span><span class="nv">GSDK_LOCATION</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>uic_arm64
</pre></div>
</div>
<p>Alternatively, use the provided <a class="reference external" href="http://runDocker.sh">runDocker.sh</a> script in the docker directory.
Fill out the GSDK_LOCATION and UIC_REPO paths in the script to properly set up
the docker image.</p>
</section>
<section id="compiling">
<h3>Compiling<a class="headerlink" href="#compiling" title="Permalink to this heading"></a></h3>
<p>To compile, run these commands from the top level Unify directory, inside the
Docker container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-GNinja<span class="w"> </span>-DCMAKE_TOOLCHAIN_FILE<span class="o">=</span>../cmake/arm64_debian.cmake<span class="w"> </span>..
ninja<span class="w">               </span><span class="c1"># Build binaries</span>
ninja<span class="w"> </span>deb<span class="w">           </span><span class="c1"># Build Debian Installers (optional)</span>
</pre></div>
</div>
</section>
<section id="advanced-feature-run-raspberry-pi-unit-tests-in-docker-on-the-host">
<h3>Advanced Feature - Run Raspberry Pi Unit Tests in Docker on the Host<a class="headerlink" href="#advanced-feature-run-raspberry-pi-unit-tests-in-docker-on-the-host" title="Permalink to this heading"></a></h3>
<p>You can run the Raspberry Pi unit tests (and ZigPC binary) within
Docker on the Host machine by using QEMU to emulate the ARM
architecture, and binfmt in the kernel, to tell Linux OS to run the ARM binaries
within QEMU.</p>
<p>To run the unit tests within Docker on the Host machine, run the following
command in the Host (not in the Docker container):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>--user<span class="w"> </span><span class="m">0</span><span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>uic_arm64<span class="w"> </span>update-binfmts<span class="w"> </span>--enable
</pre></div>
</div>
<blockquote>
<div><p>NB: This command needs to be run once after each restart of the Host machine.</p>
</div></blockquote>
<p>After enabling this you can run the unittests by issuing following command in
the <code class="docutils literal notranslate"><span class="pre">uic_arm64</span></code> docker image in the build directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
</section>
</section>
<section id="install-instructions">
<h2>Install Instructions<a class="headerlink" href="#install-instructions" title="Permalink to this heading"></a></h2>
<p>For installing please refer to the general installation method in
<a class="reference internal" href="../../doc/getting_started_unify.html"><span class="doc std std-doc">Getting started</span></a>.</p>
</section>
<section id="reading-console-logs">
<h2>Reading Console Logs<a class="headerlink" href="#reading-console-logs" title="Permalink to this heading"></a></h2>
<p>ZigPC is built on top of the Zigbee Host Wrapper Library. Currently this library
is implemented as a Silicon Labs SLC project using the SiLabs Ember Application
framework. Logs from the framework will be shown as a part of ZigPC console logs.</p>
<p>After ZigPC is launched, the logs from ZigPC will be associated with a timestamp, log
level, and a tag in the following format:</p>
<p><code class="docutils literal notranslate"><span class="pre">LOG_TIMESTAMP</span> <span class="pre">&lt;LOG_LEVEL&gt;</span> <span class="pre">[LOG_TAG]</span> <span class="pre">LOG_MESSAGE</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;LOG_LEVEL&gt;</span></code> corresponds to the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;d&gt;</span></code>: Debug log</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;i&gt;</span></code>: Info log</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;w&gt;</span></code>: Warning log</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;e&gt;</span></code>: Error log</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;c&gt;</span></code>: Critical log</p></li>
</ul>
<p>NOTE: Any log that doesn’t follow the above format is assumed to be part of
printed output from the Ember Application framework.</p>
<p>The following snippet is a snippet of example logs to expect:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>zigpc<span class="w"> </span>--zigpc.serial<span class="w"> </span>/dev/ttyACM0<span class="w"> </span>--mqtt.host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--mqtt.port<span class="w"> </span><span class="m">1883</span><span class="w"> </span>--zigpc.datastore_file<span class="w"> </span>zigpc.db
<span class="c1"># 2020-11-05 10:55:36:314815 &lt;d&gt; [sl_log] Setting log level to debug</span>
<span class="c1"># 2020-11-05 10:55:36:315475 &lt;d&gt; [uic_component_fixtures] Completed: UIC Signal Handler</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>
<span class="c1"># 2020-11-05 10:55:36:326455 &lt;d&gt; [uic_component_fixtures] Completed: UIC STDIN</span>
<span class="c1"># 2020-11-05 10:55:36:326674 &lt;d&gt; [uic_component_fixtures] Completed: ZIGPC Config</span>
<span class="c1"># [linux-serial debug] emberSerialInit()</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>
<span class="c1"># 2020-11-05 10:55:37:961488 &lt;d&gt; [zigpc_smartstart_process] SmartStart Manager Reset with new Gateway</span>
<span class="c1"># 2020-11-05 10:55:37:961592 &lt;d&gt; [mqtt_client] Subscribing to: ucl/SmartStart/List</span>
<span class="c1"># 2020-11-05 10:55:37:961802 &lt;d&gt; [mqtt_client] Subscription to ucl/by-unid/+/+/OnOff/+/ successful</span>
<span class="c1"># 2020-11-05 10:55:37:961979 &lt;d&gt; [mqtt_client] Subscription to ucl/SmartStart/List successful</span>
<span class="c1"># ZigPC&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ZigPC&gt;</span></code> prompt can be used to carry out common Protocol Controller functions.
Typing “help” brings up the currently supported functions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ZigPC&gt;<span class="w"> </span><span class="nb">help</span>
<span class="o">==================================================</span>
Unify<span class="w"> </span>Command<span class="w"> </span>line<span class="w"> </span>interface<span class="w"> </span>Help:
<span class="o">==================================================</span>
<span class="nb">exit</span><span class="w">  </span>:Exit<span class="w"> </span>the<span class="w"> </span>application
<span class="nb">help</span><span class="w">  </span>:Prints<span class="w"> </span><span class="nb">help</span>
info<span class="w">  </span>:Execute<span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>accessible<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>EmberAf<span class="w"> </span>CLI
log_level<span class="w"> </span>d<span class="p">|</span>i<span class="o">||</span>w<span class="p">|</span>e<span class="p">|</span>c:Set<span class="w"> </span>log<span class="w"> </span>levelDEBUG<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w"> </span><span class="p">|</span><span class="w"> </span>WARNING<span class="w"> </span><span class="p">|</span><span class="w"> </span>ERROR<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">CRITICAL</span>
<span class="o">==================================================</span>
Tip:<span class="w"> </span>log_level<span class="w"> </span>c<span class="w"> </span>to<span class="w"> </span>reduce<span class="w"> </span>the<span class="w"> </span>verbosity<span class="w"> </span>of<span class="w"> </span><span class="nv">log</span>
<span class="o">==================================================</span>
</pre></div>
</div>
<section id="changing-log-levels">
<h3>Changing Log Levels<a class="headerlink" href="#changing-log-levels" title="Permalink to this heading"></a></h3>
<p>Changing the log levels can be achieved using the log_level command in the
“ZigPC&gt;” console on ZigPC. The following formats are supported for this command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">log_level</span> <span class="pre">&lt;level&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log_level</span> <span class="pre">&lt;tag&gt;,&lt;level&gt;</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> corresponds to any of the tags you see in the logs (i.e., mqtt_client)</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;level&gt;</span></code> corresponds to any one of the following (can be applied overall or to
a particular log_tag):</p>
<ul class="simple">
<li><p>“off”: turn off logs</p></li>
<li><p>“d”: Show logs up to debug levels (critical, errors, warnings, info, debug)</p></li>
<li><p>“i”: Show logs up to info levels (critical, errors, warnings, info)</p></li>
<li><p>“w”: Show logs up to warning levels (critical, errors, warnings)</p></li>
<li><p>“e”: Show logs up to error levels (critical, errors)</p></li>
<li><p>“c”: Show logs up to critical levels (critical</p></li>
</ul>
<p><br><br></p>
</section>
</section>
<section id="using-zigbee-network-analyzer-to-monitor-pan">
<h2>Using Zigbee Network Analyzer to Monitor PAN<a class="headerlink" href="#using-zigbee-network-analyzer-to-monitor-pan" title="Permalink to this heading"></a></h2>
<p>The “Network Analyzer” perspective in Silicon Labs
<a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a> IDE v5
can be used to analyze the traffic on the Zigbee PAN.</p>
<p>Network activity can be observed based on the UCL commands relayed by ZigPC.</p>
<section id="installing-simplicity-studio-v5">
<h3>Installing Simplicity Studio v5<a class="headerlink" href="#installing-simplicity-studio-v5" title="Permalink to this heading"></a></h3>
<p>If you have not done so already, download Simplicity Studio v5 from
<a class="reference external" href="https://www.silabs.com/products/development-tools/software/simplicity-studio">https://www.silabs.com/products/development-tools/software/simplicity-studio</a> on
a host computer.</p>
</section>
<section id="detecting-devices-in-simplicity-studio">
<h3>Detecting Devices in Simplicity Studio<a class="headerlink" href="#detecting-devices-in-simplicity-studio" title="Permalink to this heading"></a></h3>
<p>Devices in <a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a>
can be detected using any of the following methods:</p>
<section id="connection-via-ethernet-interface">
<h4>Connection via Ethernet Interface<a class="headerlink" href="#connection-via-ethernet-interface" title="Permalink to this heading"></a></h4>
<p>If the host computer and one of the Zigbee devices are connected via Ethernet (using
a Wireless Starter Kit for example:
<a class="reference external" href="https://www.silabs.com/development-tools/wireless/efr32xg22-wireless-starter-kit">https://www.silabs.com/development-tools/wireless/efr32xg22-wireless-starter-kit</a>),
<a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a>
can capture network traffic using this interface. Either an
end device or the gateway radio can be connected via Ethernet to perform network
capture (since the serial USB connection, which ZigPC uses, can run
independently of the Ethernet connection services).</p>
<p>Instructions:</p>
<ol class="arabic simple">
<li><p>Ensure that the radio is assigned an IP address (static or dynamic).</p></li>
<li><p>In Studio, navigate from the top menu: Window → Preferences.</p></li>
<li><p>In the preferences window, go to the left menu and select: Simplicity Studio
→ Device Manager → TCP/IP Adapters.</p></li>
<li><p>In the TCP/IP Adapters view, add your device’s IP Address in the Discovery
Subnet Configuration section.</p></li>
<li><p>Click on “Apply” and then “OK”.</p></li>
<li><p>Devices will now appear in the “Debug Adapters” view.</p></li>
<li><p>If the device doesn’t appear, click on the “Refresh” icon in the “Debug
Adapters” view.</p></li>
</ol>
</section>
<section id="connection-via-serial-usb-interface">
<h4>Connection via Serial USB Interface<a class="headerlink" href="#connection-via-serial-usb-interface" title="Permalink to this heading"></a></h4>
<p>Because the Gateway radio is connected to Raspberry Pi running ZigPC, a test end
device should be connected to the host computer.</p>
<p>Instructions:</p>
<ol class="arabic simple">
<li><p>Plug in the end device to the host computer.</p></li>
<li><p>Devices will now appear in the “Debug Adapters” view.</p></li>
<li><p>If the device doesn’t appear, click on the “Refresh” icon in the “Debug
Adapters” view.</p></li>
</ol>
</section>
</section>
<section id="capturing-network-traffic-in-simplicity-studio">
<h3>Capturing Network Traffic in Simplicity Studio<a class="headerlink" href="#capturing-network-traffic-in-simplicity-studio" title="Permalink to this heading"></a></h3>
<p>Using the top menu, select Window → Perspective → Network Analyzer.</p>
<p>Then, in the “Debug Adapters” window, right-click on the connected device and
click “Connect”, then click “Start capture”.</p>
<p>This will trigger the Network Analyzer to record PAN events, as shown below:</p>
<p><img alt="" src="../../_images/user_guide-network-analyzer-view.png" /></p>
<p>The middle table, labeled “Transactions”, can be used to get a high-level
overview of messages sent on the network.</p>
</section>
<section id="decrypting-network-traffic-in-simplicity-studio">
<h3>Decrypting Network Traffic in Simplicity Studio<a class="headerlink" href="#decrypting-network-traffic-in-simplicity-studio" title="Permalink to this heading"></a></h3>
<p>ZigPC uses Network key (NWK key) based on the install code. In typical Zigbee
applications, the Ember CLI can be used to get this key. The CLI can be
re-enabled at compilation time, however, the network information is also
printed out at startup.</p>
<p>Look for the following pattern:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>DEBUG<span class="o">]</span><span class="w"> </span>NWK<span class="w"> </span>Key::<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ<span class="w"> </span>ZZ
</pre></div>
</div>
<p>Extract the NWK key value ( <code class="docutils literal notranslate"><span class="pre">ZZ</span> <span class="pre">ZZ</span> <span class="pre">ZZ</span> <span class="pre">...</span></code> sequence in the log above) and add
it as a Network Analyzer Security Key using the following instructions:</p>
<ol class="arabic simple">
<li><p>Open <a class="reference external" href="https://www.silabs.com/developers/simplicity-studio">Simplicity Studio</a> v5.</p></li>
<li><p>Click from the top menu: Window -&gt; Preferences.</p></li>
<li><p>From the left sidebar, select: Network Analyzer -&gt; Decoding -&gt; Security Keys.</p></li>
<li><p>Add a New Entry and insert the NWK key as the Key value.</p></li>
<li><p>Click Apply then OK.</p></li>
</ol>
<p>This NWK key can now decrypt network traffic after the node has joined
the network.</p>
<p>For more information, see <a class="reference external" href="https://www.silabs.com/documents/public/quick-start-guides/qsg106-efr32-zigbee-pro.pdf">“Section 6: Using the Network Analyzer” in QSG106:
Zigbee EmberZNet PRO Quick-Start Guide</a>.</p>
<p>For example, the following decrypted transactions are seen when the SmartStart
addition is performed to add an end device to the PAN using the Install
Code based DSK:</p>
<p><img alt="" src="../../_images/user_guide-network-analyzer-node-add.png" /></p>
</section>
<section id="adding-custom-clusters">
<h3>Adding custom clusters<a class="headerlink" href="#adding-custom-clusters" title="Permalink to this heading"></a></h3>
<p>It is possible to add custom ZCL info to ZigPC to add natively unsupported
clusters or to override the functionality of default clusters. This step must
be run at compilation time in order to properly include the necessary MQTT
topics and other related ZCL information.</p>
<ul class="simple">
<li><p>Step 1: Adding the custom cluster to the Unify framework</p></li>
</ul>
<p>Add a custom XML file (or modify an existing XML file) in the shared components
of the Unify framework. All XML files defining ZCL clusters are stored in the
‘uic-dotdot’ component under the ‘dotdot-xml’ folder. If a new XML file is
added or if the name of an XML file changes, that change must be reflected in
the library.xml file</p>
<ul class="simple">
<li><p>Step 2: Adding the custom cluster in the ZigPC</p></li>
</ul>
<p>ZigPC generates ZCL-cluster code and structures using ZAP. Ensure that the ZAP
templates will generate for the new cluster by adding the name to:
‘uic/applications/zigpc/components/zcl_util/zap/addon-helper.js
Specifically, the ‘SUPPORTED_CLUSTERS’ and ‘SUPPORTED_CLUSTER_ATTRIBUTES’
lists must reference the new cluster.</p>
<ul class="simple">
<li><p>Step 3: Adding the custom clusters in the zigbeeHost gateway level</p></li>
</ul>
<p>ZigPC uses a custom zigbeeHost layer to manage the zigbee stack. Ensure that
this layer can also access the new ZCL cluster by modifying the slcp file
in ‘uic/applications/zigpc/components/zigpc_gateway/libs/zigbee_host/src/libzigbee_host.slcp’
Add the new cluster in the same format as all the existing clusters at this layer.</p>
<p>*Step 4: Re-generate all ZAP templates</p>
<p>Unify uses ZAP to generate ZCL cluster information (as discussed in step #2).
Make sure that zap can find the library by modifying its configuration file.</p>
<p>Alternatively, compile with the cmake option ‘ZAP_GENERATE’ set to ‘ON’ to
automatically re-generate zap output files as part of the compilation process.</p>
<p>Re-generate all zap output in the top level uic for the following components:
uic_dotdot, uic_dotdot_mqtt, unify_dotdot_attribute_store</p>
<p>Re-generate all zap output in the zigpc level for the following components:
command_mapper, zcl_util, zcl_command_parser, zcl_profiles, attribute_management</p>
<p>Please take a look at [<a class="reference external" href="https://github.com/SiliconLabs/zap">https://github.com/SiliconLabs/zap</a>] for more detailed
information.</p>
<ul class="simple">
<li><p>Step 5: Re-generate the zigbee_host</p></li>
</ul>
<p>Re-generate the zigbee_host slcp, in the autogen folder. Set the
STUDIO_ADAPTER_PATH to point to zap, which should already be configured
to point to the custom xml. Otherwise, it will be necessary to edit the
zap-config of the zigbee_host folder.</p>
<p>Please read [<a class="reference external" href="https://siliconlabs.github.io/slc-specification/1.0/">https://siliconlabs.github.io/slc-specification/1.0/</a>] and
[<a class="reference external" href="https://www.silabs.com/documents/public/user-guides/ug520-software-project-generation-configuration-with-slc-cli.pdf">https://www.silabs.com/documents/public/user-guides/ug520-software-project-generation-configuration-with-slc-cli.pdf</a>]
for more information on using the slc_cli.</p>
<ul class="simple">
<li><p>Step 6:</p></li>
</ul>
<p>Compile ZigPC as normal. ZigPC should now support your custom cluster</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2023 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>