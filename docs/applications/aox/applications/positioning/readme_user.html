<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AoX Positioning User Guide &mdash; Unify Host SDK</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom_styles.css" type="text/css" />
    <link rel="canonical" href="https://siliconlabs.github.io/UnifySDK/applications/aox/applications/positioning/readme_user.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/js/charenc.js"></script>
        <script src="../../../../_static/js/crypt.js"></script>
        <script src="../../../../_static/js/sha1.js"></script>
        <script src="../../../../_static/js/html5-qrcode.min.js"></script>
        <script src="../../../../_static/js/qr_code_scanner.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="AoX Positioning Developer’s Guide" href="readme_developer.html" />
    <link rel="prev" title="AoXPC Developer’s Guide" href="../aoxpc/readme_developer.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../doc/introduction.html" class="icon icon-home"> Unify
            <img src="../../../../_static/silicon-labs-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                ver_1.6.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/introduction.html">Unify Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/getting_started_unify.html">Getting Started with Unify</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/UnifySDK.html">Unify Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/unify_framework_services.html">Framework Services</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../doc/protocol_controllers.html">Protocol Controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../doc/protocol/zwave/zpc_introduction.html">Z-Wave (ZPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../doc/protocol/zigbee/zigpc_introduction.html">Zigbee (ZigPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../doc/multiprotocol.html">Multiprotocol Host Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../doc/protocol/matter/matter_mpc.html">Matter Protocol Controller (MPC)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../doc/protocol/aox/aox_introduction.html">Bluetooth AoX (AoXPC)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../aoxpc/readme_user.html">AoXPC User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aoxpc/readme_developer.html">AoXPC Developer’s Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">AoX Positioning User Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#operation">Operation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="readme_developer.html">AoX Positioning Developer’s Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/unify_iot_services.html">IoT Services</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/getting_started_as_developer.html">Getting Started as a Developer</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/unify_specifications/index.html">Unify Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/standards/known-abbreviations.html">Known Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc/license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../doc/introduction.html">Unify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <script>
    $(".wy-side-scroll").append("<div class='github-button'><iframe src='https://ghbtns.com/github-btn.html?user=SiliconLabs&repo=UnifySDK&type=watch&count=true&size=large&v=2' allowtransparency='true' frameborder='0' scrolling='0' width='170' height='30'></iframe></div>");
</script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="aox-positioning-user-guide">
<h1>AoX Positioning User Guide<a class="headerlink" href="#aox-positioning-user-guide" title="Permalink to this heading"></a></h1>
<p>This user guide will guide the reader on how to install, configure and run the
Positioning IoT Service.</p>
<p>Readers of this document should be familiar with the <a class="reference internal" href="../aoxpc/readme_user.html"><span class="doc std std-doc">AoXPC</span></a>,
because the position estimation service is based on the angle data provided by
the AoXPC instances.</p>
<section id="operation">
<h2>Operation<a class="headerlink" href="#operation" title="Permalink to this heading"></a></h2>
<p>The positioning service starts automatically as a systemd service. For more
information on installation and systemd services, see <a class="reference internal" href="../../../../doc/unify_readme_user.html"><span class="doc std std-doc">Unify Framework User guide</span></a>.</p>
<p>The service detects the locators connected to the system automatically.
Locators need to be configured as described in the <a class="reference internal" href="../aoxpc/readme_user.html"><span class="doc std std-doc">AoXPC User Guide</span></a>.
The locator configuration is considered valid if the <code class="docutils literal notranslate"><span class="pre">PositionAndOrientationValid</span></code>
attribute is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>Once a locator is configured, there is no way to exclude it from the position
estimation. Only one positioning service is supported per MQTT broker.</p>
<p>Asset tags are presented as individual nodes on the MQTT network by the
positioning service. The estimated position of the asset tag is presented as an
AoXPositionEstimation cluster attribute, as follows.</p>
<div class="highlight-mqtt notranslate"><div class="highlight"><pre><span></span><span class="ow">ucl/by-unid/&lt;TAG_UNID&gt;/ep0/AoXPositionEstimation/Attributes/Position/Reported</span> - {
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span>{
<span class="w">    </span><span class="nt">&quot;ApplicationId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;positioning_4154&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationX&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.1297969818115234</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.6999226212501526</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DeviationZ&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.8446271419525146</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Sequence&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">47021</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8519021272659302</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.000349800189724192</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8335742950439453</span>
<span class="w">  </span>}
}
</pre></div>
</div>
<section id="position-estimation-with-one-locator">
<h3>Position Estimation with One Locator<a class="headerlink" href="#position-estimation-with-one-locator" title="Permalink to this heading"></a></h3>
<p>The positioning service allows to estimate position even with one locator.
To achieve this, RSSI based distance estimation is used. If the received signal
strength of the incoming signal is altered for any other reason than the
distance between the TX and RX itself, it will lead to incorrect distance
measurement and it will lead to incorrect position estimates.</p>
<p>Therefore, using multiple locators is advised for accurate position estimation.</p>
</section>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The positioning service can be configured with the same JSON config file as the
AoXPC. The path of the config file can be specified with the
<code class="docutils literal notranslate"><span class="pre">--positioning.config</span></code> CLI option.</p>
<p>These are the configuration parameters that are relevant for the
positioning service, with their default values:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;positioning_&lt;PID&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;estimationModeLocation&quot;</span><span class="p">:</span><span class="s2">&quot;SL_RTL_LOC_ESTIMATION_MODE_THREE_DIM_HIGH_ACCURACY&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;validationModeLocation&quot;</span><span class="p">:</span><span class="s2">&quot;SL_RTL_LOC_MEASUREMENT_VALIDATION_MEDIUM&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;estimationIntervalSec&quot;</span><span class="p">:</span><span class="mf">0.02</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;locationFiltering&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;locationFilteringWeight&quot;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;numberOfSequenceIds&quot;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;maximumSequenceIdDiffs&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let’s see these parameters in detail.</p>
<section id="id">
<h3>id<a class="headerlink" href="#id" title="Permalink to this heading"></a></h3>
<p>This parameter controls the <code class="docutils literal notranslate"><span class="pre">ApplicationId</span></code> field of the <code class="docutils literal notranslate"><span class="pre">Position</span></code> attribute.
The default value is derived from the process ID. It can be replaced with any
string.</p>
</section>
<section id="estimationmodelocation">
<h3>estimationModeLocation<a class="headerlink" href="#estimationmodelocation" title="Permalink to this heading"></a></h3>
<p>Estimation mode used by the position estimation algorithm.</p>
<p>For more details, see <a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#gacf5978113a013aa36cbdb85bfc937aed">sl_rtl_loc_set_mode</a>.</p>
</section>
<section id="validationmodelocation">
<h3>validationModeLocation<a class="headerlink" href="#validationmodelocation" title="Permalink to this heading"></a></h3>
<p>The positioning service implements an angle correction mechanism for a deviating
locator whose angle reports are far off the expected one, and thus is not
pointing to the same direction where all other locators see the tag. The
correction feedback provides the locator with the information in which direction
it is supposed to see the tag. This helps locators that locked up on a
reflection signal which is stronger than the one coming in the line-of sight
direction.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">validationModeLocation</span></code> parameter determines the sensitivity of the angle
correction mechanism.</p>
<p>For more details, see <a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#ga424290857cf7416aef48d72ed31d84a2">sl_rtl_loc_set_measurement_validation</a>.</p>
</section>
<section id="estimationintervalsec">
<h3>estimationIntervalSec<a class="headerlink" href="#estimationintervalsec" title="Permalink to this heading"></a></h3>
<p>Estimation interval in seconds. This value should approximate the time interval
between two consecutive CTEs received from an asset tag.</p>
<p>For more details, see <a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-loc#gaa2a04c7e40ec23d2451cd63d0a6024db">sl_rtl_loc_process</a>.</p>
</section>
<section id="locationfiltering-locationfilteringweight">
<h3>locationFiltering, locationFilteringWeight<a class="headerlink" href="#locationfiltering-locationfilteringweight" title="Permalink to this heading"></a></h3>
<p>An optional filter can be applied on the position coordinates, <code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code> and <code class="docutils literal notranslate"><span class="pre">Z</span></code>
to reduce noise. Filter weight ranges from 0 to 1.</p>
<p>For more details, see <a class="reference external" href="https://docs.silabs.com/rtl-lib/latest/group-sl-rtl-util#ga41610abd68f01bc6871e084fc28ed000">sl_rtl_util_filter</a>.</p>
</section>
<section id="numberofsequenceids-maximumsequenceiddiffs">
<h3>numberOfSequenceIds, maximumSequenceIdDiffs<a class="headerlink" href="#numberofsequenceids-maximumsequenceiddiffs" title="Permalink to this heading"></a></h3>
<p>The CTE signals can be identified by their sequence ID which is a monotonic
increasing number. When the positioning service receives an angle report
estimated from that CTE, it knows</p>
<ul class="simple">
<li><p>the transmitter of the CTE (asset tag)</p></li>
<li><p>the receiver of the CTE (locator)</p></li>
<li><p>the sequence ID of the CTE.</p></li>
</ul>
<p>Ideally, a CTE signal is processed by all of the locators in the AoA system, so
the positioning service simply has to wait for all angle reports from all
locators with a given sequence ID. Once all angle reports have arrived, the
positioning can start the position estimation. But what happens if a CTE is
missed by a locator, or a locator is temporarily unavailable?</p>
<p>The <code class="docutils literal notranslate"><span class="pre">angle_queue</span></code> component is responsible for collecting the angle reports that
belong to the same CTE (i.e., have the same sequence ID) and go on with position
estimation even under suboptimal conditions.
<code class="docutils literal notranslate"><span class="pre">numberOfSequenceIds</span></code> and <code class="docutils literal notranslate"><span class="pre">maximumSequenceIdDiffs</span></code> can be used to tweak the
behavior of the <code class="docutils literal notranslate"><span class="pre">angle_queue</span></code> component.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">numberOfSequenceIds</span></code> tells how many sequence IDs shall be tracked maximum
for a given asset tag. If <code class="docutils literal notranslate"><span class="pre">numberOfSequenceIds</span></code> is exceeded, the angle reports
with the oldest sequence ID are deleted. This parameter also determines the
number of angle reports the positioning has to wait for before starting the
position estimation. The expected angle count depends on the “age” of
the sequence ID in a linear way. This means, Only 2 angle reports are expected
for the oldest sequence ID, for the newest sequence ID all locators are expected
to send an angle report. In the following example, we have 7 locators,
<code class="docutils literal notranslate"><span class="pre">numberOfSequenceIds</span></code> is 6.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Slot</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence ID</td>
<td>101</td>
<td>102</td>
<td>103</td>
<td>104</td>
<td>105</td>
<td>106</td>
</tr>
<tr>
<td>Angles expected</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">maximumSequenceIdDiffs</span></code> sets another limit on the sequence IDs. If the sequence
ID difference between the oldest and the newest angle report exceeds this limit,
then the angle reports with the oldest sequence ID are deleted.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <hr/>
    <p>Copyright © 2023 Silicon Laboratories. All rights reserved.</p>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>